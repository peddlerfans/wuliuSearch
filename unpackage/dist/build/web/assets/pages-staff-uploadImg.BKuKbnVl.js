import{_ as a,r as e,a as t,w as l,i as s,o,d as c,b as n,u,p as i,q as r,F as d,t as f,x as p,y as _,z as m,A as b,f as v,B as g,l as h}from"./index-l3yfvvcJ.js";import{b as y}from"./staff.BAYZVc4t.js";import{C as k}from"./CustomTabbar.DN48_poM.js";import"./api.C0Evyluq.js";const x=a({__name:"uploadImg",setup(a){const x=e(!1),j=e(!1),w=e(""),C=e([]),I=[{pagePath:"pages/staff/index",text:"装箱单"},{pagePath:"pages/staff/uploadImg",text:"上传"}];function P(){p({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:a=>{j.value=!0,_({title:"上传中..."}),m({url:"https://djtestweb.youyong.org.cn/api/upload/image",filePath:a.tempFilePaths[0],header:{Authorization:"Bearer "+b("token")},name:"file",success:a=>{try{const e=JSON.parse(a.data);if(200!==e.code&&0!==e.code||!e.data)v({title:"上传失败："+(e.msg||"未知错误"),icon:"none"});else{const a=e.data;w.value=a.trade_no||"",C.value=a.products||[],x.value=!0}}catch(e){console.error("解析失败",e),v({title:"返回数据异常",icon:"none"})}j.value=!1,g()},fail:a=>{console.error("上传失败",a),j.value=!1,g(),v({title:"上传失败",icon:"none"})}})}})}function z(){_({title:"取消中..."}),y({trade_no:w.value,status:1}).then((()=>{g(),v({title:"取消成功",icon:"success"}),x.value=!1})).catch((a=>{console.error(a),g(),v({title:"提交失败",icon:"none"})}))}function T(){w.value?(_({title:"提交中..."}),y({trade_no:w.value,status:1}).then((()=>{g(),v({title:"确认成功",icon:"success"}),x.value=!1})).catch((a=>{console.error(a),g(),v({title:"提交失败",icon:"none"})}))):v({title:"未识别到运单号",icon:"none"})}return(a,e)=>{const p=s,_=h;return o(),t(p,{class:"container"},{default:l((()=>[x.value?(o(),t(p,{key:1,class:"result"},{default:l((()=>[n(p,{class:"waybill"},{default:l((()=>[c("运单号："+u(w.value),1)])),_:1}),n(p,{class:"material-table-wrapper"},{default:l((()=>[n(p,{class:"material-table"},{default:l((()=>[n(p,{class:"table-header"},{default:l((()=>[n(p,{class:"table-cell"},{default:l((()=>[c("物料型号")])),_:1}),n(p,{class:"table-cell"},{default:l((()=>[c("数量")])),_:1})])),_:1}),(o(!0),i(d,null,r(C.value,((a,e)=>(o(),t(p,{key:e,class:"table-row"},{default:l((()=>[n(p,{class:"table-cell"},{default:l((()=>[c(u(a.product_model),1)])),_:2},1024),n(p,{class:"table-cell"},{default:l((()=>[c(u(a.product_num),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),n(p,{class:"action-btns"},{default:l((()=>[n(_,{class:"cancel-btn",onClick:z},{default:l((()=>[c("取消")])),_:1}),n(_,{class:"confirm-btn",onClick:T},{default:l((()=>[c("确定")])),_:1})])),_:1}),n(p,{class:"tip-text"},{default:l((()=>[c(" 点击确认后，该识别结果将存入数据库 ")])),_:1})])),_:1})):(o(),t(p,{key:0,class:"info-text"},{default:l((()=>[c(" 点击按钮导入装箱单 ")])),_:1})),x.value?f("",!0):(o(),t(_,{key:2,class:"upload-btn",onClick:P,loading:j.value,disabled:j.value},{default:l((()=>[c(u(j.value?"上传中...":"开始"),1)])),_:1},8,["loading","disabled"])),n(k,{tabs:I,current:"pages/staff/uploadImg"})])),_:1})}}},[["__scopeId","data-v-8daf422c"]]);export{x as default};

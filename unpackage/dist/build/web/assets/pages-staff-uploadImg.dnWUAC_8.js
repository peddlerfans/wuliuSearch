import{_ as a,r as e,E as l,C as t,G as s,c as o,w as c,i as n,o as u,b as i,a as d,t as r,j as f,k as _,F as p,h as v,z as b,A as m,B as h,s as y,D as k,d as g}from"./index-48tkzOBv.js";import{b as j}from"./staff.B8MeApKU.js";import"./api.BKjFQra2.js";const w=a({__name:"uploadImg",setup(a){const w=e(!1),x=e(!1),C=e(""),z=e([]);function D(){b({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:a=>{x.value=!0,m({title:"上传中..."}),h({url:"https://djtestweb.youyong.org.cn/api/upload/image",filePath:a.tempFilePaths[0],header:{Authorization:"Bearer "+t("token")},name:"file",success:a=>{try{const e=JSON.parse(a.data);if(200!==e.code&&0!==e.code||!e.data)y({title:"上传失败："+(e.msg||"未知错误"),icon:"none"});else{const a=e.data;C.value=a.trade_no||"",z.value=a.products||[],w.value=!0}}catch(e){console.error("解析失败",e),y({title:"返回数据异常",icon:"none"})}x.value=!1,k()},fail:a=>{console.error("上传失败",a),x.value=!1,k(),y({title:"上传失败",icon:"none"})}})}})}function A(){m({title:"取消中..."}),j({trade_no:C.value,status:1}).then((()=>{k(),y({title:"取消成功",icon:"success"}),w.value=!1})).catch((a=>{console.error(a),k(),y({title:"提交失败",icon:"none"})}))}function B(){C.value?(m({title:"提交中..."}),j({trade_no:C.value,status:1}).then((()=>{k(),y({title:"确认成功",icon:"success"}),w.value=!1})).catch((a=>{console.error(a),k(),y({title:"提交失败",icon:"none"})}))):y({title:"未识别到运单号",icon:"none"})}return l((()=>{const a=t("uploadData");a&&(C.value=a.trade_no||"",z.value=a.products||[],w.value=!0,s("uploadData"))})),(a,e)=>{const l=n,t=g;return u(),o(l,{class:"container"},{default:c((()=>[w.value?(u(),o(l,{key:1,class:"result"},{default:c((()=>[d(l,{class:"waybill"},{default:c((()=>[i("运单号："+r(C.value),1)])),_:1}),d(l,{class:"material-table-wrapper"},{default:c((()=>[d(l,{class:"material-table"},{default:c((()=>[d(l,{class:"table-header"},{default:c((()=>[d(l,{class:"table-cell"},{default:c((()=>[i("物料型号")])),_:1}),d(l,{class:"table-cell"},{default:c((()=>[i("数量")])),_:1})])),_:1}),(u(!0),f(p,null,_(z.value,((a,e)=>(u(),o(l,{key:e,class:"table-row"},{default:c((()=>[d(l,{class:"table-cell"},{default:c((()=>[i(r(a.product_model),1)])),_:2},1024),d(l,{class:"table-cell"},{default:c((()=>[i(r(a.product_num),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),d(l,{class:"action-btns"},{default:c((()=>[d(t,{class:"cancel-btn",onClick:A},{default:c((()=>[i("取消")])),_:1}),d(t,{class:"confirm-btn",onClick:B},{default:c((()=>[i("确定")])),_:1})])),_:1}),d(l,{class:"tip-text"},{default:c((()=>[i(" 点击确认后，该识别结果将存入数据库 ")])),_:1})])),_:1})):(u(),o(l,{key:0,class:"info-text"},{default:c((()=>[i(" 点击按钮导入装箱单 ")])),_:1})),w.value?v("",!0):(u(),o(t,{key:2,class:"upload-btn",onClick:D,loading:x.value,disabled:x.value},{default:c((()=>[i(r(x.value?"上传中...":"开始"),1)])),_:1},8,["loading","disabled"]))])),_:1})}}},[["__scopeId","data-v-64ed7762"]]);export{w as default};

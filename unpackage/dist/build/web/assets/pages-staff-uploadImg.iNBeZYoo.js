import{_ as a,r as e,a as l,w as t,i as s,o as c,d as o,b as u,u as n,p as i,q as d,F as r,t as f,x as _,y as p,z as v,A as b,f as m,B as y,l as h}from"./index-Btepo-jy.js";import{b as g}from"./staff.-6U8UApu.js";import"./api.DuMj0eHO.js";const k=a({__name:"uploadImg",setup(a){const k=e(!1),w=e(!1),x=e(""),j=e([]);function z(){_({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:a=>{w.value=!0,p({title:"上传中..."}),v({url:"https://djtestweb.youyong.org.cn/api/upload/image",filePath:a.tempFilePaths[0],header:{Authorization:"Bearer "+b("token")},name:"file",success:a=>{try{const e=JSON.parse(a.data);if(200!==e.code&&0!==e.code||!e.data)m({title:"上传失败："+(e.msg||"未知错误"),icon:"none"});else{const a=e.data;x.value=a.trade_no||"",j.value=a.products||[],k.value=!0}}catch(e){console.error("解析失败",e),m({title:"返回数据异常",icon:"none"})}w.value=!1,y()},fail:a=>{console.error("上传失败",a),w.value=!1,y(),m({title:"上传失败",icon:"none"})}})}})}function C(){k.value=!1,x.value="",j.value=[]}function A(){x.value?(p({title:"提交中..."}),g({trade_no:x.value,status:1}).then((()=>{y(),m({title:"确认成功",icon:"success"}),k.value=!1})).catch((a=>{console.error(a),y(),m({title:"提交失败",icon:"none"})}))):m({title:"未识别到运单号",icon:"none"})}return(a,e)=>{const _=s,p=h;return c(),l(_,{class:"container"},{default:t((()=>[k.value?(c(),l(_,{key:1,class:"result"},{default:t((()=>[u(_,{class:"waybill"},{default:t((()=>[o("运单号："+n(x.value),1)])),_:1}),u(_,{class:"material-table-wrapper"},{default:t((()=>[u(_,{class:"material-table"},{default:t((()=>[u(_,{class:"table-header"},{default:t((()=>[u(_,{class:"table-cell"},{default:t((()=>[o("物料型号")])),_:1}),u(_,{class:"table-cell"},{default:t((()=>[o("数量")])),_:1})])),_:1}),(c(!0),i(r,null,d(j.value,((a,e)=>(c(),l(_,{key:e,class:"table-row"},{default:t((()=>[u(_,{class:"table-cell"},{default:t((()=>[o(n(a.product_model),1)])),_:2},1024),u(_,{class:"table-cell"},{default:t((()=>[o(n(a.product_num),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),u(_,{class:"action-btns"},{default:t((()=>[u(p,{class:"cancel-btn",onClick:C},{default:t((()=>[o("取消")])),_:1}),u(p,{class:"confirm-btn",onClick:A},{default:t((()=>[o("确定")])),_:1})])),_:1}),u(_,{class:"tip-text"},{default:t((()=>[o(" 点击确认后，该识别结果将存入数据库 ")])),_:1})])),_:1})):(c(),l(_,{key:0,class:"info-text"},{default:t((()=>[o(" 点击按钮导入装箱单 ")])),_:1})),k.value?f("",!0):(c(),l(p,{key:2,class:"upload-btn",onClick:z,loading:w.value,disabled:w.value},{default:t((()=>[o(n(w.value?"上传中...":"开始"),1)])),_:1},8,["loading","disabled"]))])),_:1})}}},[["__scopeId","data-v-3e7cc22d"]]);export{k as default};
